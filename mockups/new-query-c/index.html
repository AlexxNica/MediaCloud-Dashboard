<!DOCTYPE html>
<html>
    <head>
        <title>Media Meter Dashboard</title>
        <link rel="stylesheet" type="text/css" href="static/core/lib/bootstrap/css/bootstrap.min.css"/>
        <link rel="stylesheet" type="text/css" href="static/core/lib/typeahead.js-bootstrap/typeahead.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,700" type="text/css">
        <link rel="stylesheet" type="text/css" href="static/core/mediameter.css"/>
        <link rel="stylesheet" type="text/css" href="static/dashboard/style.css"/>
    </head>
    <body>
        <div class="header">
            <div class="brand-toolbar">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-8 links"></div>
                        <div class="col-sm-4 controls"></div>
                    </div>
                </div>
            </div>
            <div class="branding">
                <div class="container">
                    <h1>
                        <a href="http://dashboard.mediameter.org/"><img src="static/core/img/mm-logo-65-orange.png" /></a>
                        <strong>Media Meter</strong>
                        Dashboard
                        <small class="pull-right">Powered by <a href="http://mediacloud.org">Media Cloud</a></small>
                    </h1>
                </div>
            </div>
            <div class="app-toolbar">
                <div class="container">
                </div>
            </div>
        </div>
        <div class="drawer">
            <div class="container">
            </div>
        </div>
        <div class="messages">
            <div class="container">
            </div>
        </div>
        <div class="content">
            <div class="container">
                <div class="messages"></div>
                    <form role="form">

                        <div class="row" id="query-list-wrapper">

                            <div class="query-wrapper first-query-wrapper" id="query1">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <span class="pull-right">
                                            <a href="#" onclick="hideQuery(this);"><span class="glyphicon glyphicon-remove query-remove"></span></a>
                                        </span>
                                        <span class="query-title">Search 
                                            <span class="query-number">1</span> &nbsp;
                                            <span class="glyphicon glyphicon-edit"></span>
                                        </span>
                                    </div>
                                </div>
                                <div class="query-view-content">
                                    <div class="row">
                                        <div class="col-sm-12 form-group">
                                            <div class="input-group">
                                                <div class="query-phrase">search for these words
                                                    <a href="#" title="copy these words to all your searches"><span class="propagate-btn glyphicon glyphicon-forward"></span></a>
                                                </div>
                                                <textarea class="form-control" width="100%" rows="1" cols="60">obama AND economy</textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-12 form-group">
                                            <div class="query-phrase">in these media sources
                                                <a href="#" title="copy these media sources to all your searches"><span class="propagate-btn glyphicon glyphicon-forward"></span></a>
                                            </div>
                                            <ul class="query-media-list">
                                                <li>Collections: U.S. Mainstream Media
                                                    <a tabindex="-1" class="remove" href="#" onclick="hideParentLi(this);"><small><span class="glyphicon glyphicon-remove"></span></small></a>
                                                </li>
                                                <li class="source-that-got-added" style="display:none;">BBC World News
                                                    <a tabindex="-1" class="remove" href="#" onclick="hideParentLi(this);"><small><span class="glyphicon glyphicon-remove"></span></small></a>
                                                </li>
                                                <li class="add-sources-action"><a href="#" onclick="showAddSource(this);">add more</a></li>
                                            </ul>
                                            <div class="input-group add-sources-content simple-tag-select-view" style="display:none;">
                                                <input placeholder="search for media sources" type="text" class="simple-tag-input form-control add-sources-field" autocomplete="off" maxsize="50"/>
                                                 <span class="input-group-btn">
                                                    <button class="btn btn-default" type="button" onclick="addSource(this);">add it</button>
                                                  </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-12 form-group">
                                            <div style="width:360px">
                                                <div class="query-phrase">between these dates
                                                    <a href="#" title="copy these dates to all your searches"><span class="propagate-btn glyphicon glyphicon-forward"></span></a>
                                                </div>
                                                <div class="input-group">
                                                    <input
                                                        class="date-range-start form-control"
                                                        value="2015-01-01"/>
                                                    <div class="input-group-addon">and</div>
                                                    <input
                                                      class="date-range-end form-control"
                                                      value="2015-01-31"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div> <!-- query wrapper -->

                        </div>  <!-- row of queries -->

                        <div class="row">
                            <div class="col-sm-8">
                                <div class="form-group last-element" style="margin-top:20px;">
                                    <button id="runOneBtn" type="submit" class="btn btn-primary">Run Search</button>
                                    <button id="runManyBtn" style="display:none" type="submit" class="btn btn-primary">Compare Searches</button>
                                    &nbsp; &nbsp;
                                    <button type="button" id="add-query-btn" class="btn btn-default" onclick="addAnotherQuery();">Add Another Search</button>
                                </div>
                            </div>                    
                            <div class="col-sm-4">
                                <div class="pull-right" id="scrollRightNote" style="display:none;">
                                <i style="color:#777777;">scroll right to see the rest of your searches &rarr;</i>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div style="margin: 20px 0px; border: 1px solid black; padding: 20px;">
                            query results, in boxes, go down here..
                            </div>
                        </div>

                    </form>
                </div>
            </div>
        </div>
        <div class="footer">
            <div class="container">
                <div class="row">
                    <div class="col-sm-4">
                        <h3>About Media Meter</h3>
                        <p>
What was covered in the news this week? Did the issues you care about get the
attention you think they deserved? Did the media talk about these topics in the
way you want them to? Who set the narrative for the current breaking story?
                        </p>
                        <p>
<a href="http://mediameter.org">MediaMeter</a> is a suite of tools built on top of the 
<a href="http://mediacloud.org">Media Cloud</a> online news database. A number of tools 
make up the suite, all driven by a query you author to specify media sources, a date range, 
and some keywords.
                        </p>
                    </div>
                    <div class="col-sm-2 col-sm-offset-1">
                        <h3>Contact</h3>
<p>
If you have feedback or questions, you can get in touch with us at
<a href="mailto:mediameter@media.mit.edu">mediameter@media.mit.edu</a>.
</p>
<p>
Please enter any bugs or <a href="https://github.com/c4fcm/MediaMeter-Dashboard/issues">issues on GitHub</a>.
</p>
                    </div>
                    <div class="col-sm-4 col-sm-offset-1">
                        <h3><a href="http://civic.mit.edu"><img class="img-responsive" src="static/core/img/civic.png"/></a></h3>
                        <h3><a href="http://cyber.law.harvard.edu"><img class="img-responsive" src="static/core/img/berkman.png"/></a></h3>
                    </div>
                </div>
            </div>
        </div>
        <script type="text/javascript" src="static/core/lib/jquery/js/jquery-2.1.1.min.js"></script>
        <script type="text/javascript" src="static/core/lib/jquery/js/jquery.cookie-1.4.1.js"></script>
        <script type="text/javascript" src="static/core/lib/underscore/underscore-1.6.0-min.js"></script>
        <script type="text/javascript" src="static/core/lib/backbone/backbone-1.1.2-min.js"></script>
        <script type="text/javascript" src="static/core/lib/bootstrap/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="static/core/lib/typeahead/typeahead.bundle.min.js"></script>
        <script type="text/javascript" src="static/core/lib/datepicker/js/bootstrap-datepicker.js"></script>
        <script type="text/javascript" src="static/core/lib/d3/js/d3-3.4.11.min.js"></script>
        <script type="text/javascript" src="static/core/lib/d3-cloud/js/d3-cloud-civic.js"></script>
        <script type="text/javascript">
var substringMatcher = function(strs) {
  return function findMatches(q, cb) {
    var matches, substrRegex;
 
    // an array that will be populated with substring matches
    matches = [];
 
    // regex used to determine if a string contains the substring `q`
    substrRegex = new RegExp(q, 'i');
 
    // iterate through the pool of strings and for any string that
    // contains the substring `q`, add it to the `matches` array
    $.each(strs, function(i, str) {
      if (substrRegex.test(str)) {
        // the typeahead jQuery plugin expects suggestions to a
        // JavaScript object, refer to typeahead docs for more info
        matches.push({ value: str });
      }
    });
 
    cb(matches);
  };
};

var sources = [
    "The Boston Globe",
    "The Boston Herald",
    "Boston Magazine",
    "boston.com"
];

var tags = [
    "Collections: U.S. Technoroti Political Blogs 2008",
    "Collections: U.S. Yahoo Political Blogs 2008",
    "Collections: Internet and Democracy Blogs",
    "Collections: U.S. Popular Blogs",
    "Collections: Tech Blogs"
];

$('.simple-tag-select-view input').typeahead({
    hint: true,
    highlight: false,
    minLength: 1
    },
    {
        name: 'tags',
        displayKey: 'value',
        source: substringMatcher(tags)
    });
$('.media-select-view input').typeahead({
    hint: true,
    highlight: false,
    minLength: 1
    },
    {
        name: 'tags',
        displayKey: 'value',
        source: substringMatcher(sources)
    });
$('.date-range-start').datepicker({format: 'yyyy-mm-dd'});
$('.date-range-end').datepicker({format: 'yyyy-mm-dd'});

$('.simple-tag-select-view input').on('typeahead:selected', function () {
    $el = $(this);
    setTimeout(function () {
        $el.val('');
    }, 0);
    $el.parents('.query-view-content').find('.label').css('display', 'block');
});

/** Rahul's mockup code **/
function hideParentLi(elem){
    $(elem).parent().hide();
}
function showAddSource(elem){
    var queryWrapper = $(elem).closest('.query-wrapper');
    queryWrapper.find('.add-sources-content').show();
    queryWrapper.find('.add-sources-action').hide();
    queryWrapper.find('.add-sources-field').focus();
}
function addSource(elem){
    var queryWrapper = $(elem).closest('.query-wrapper');
    queryWrapper.find('.add-sources-content').hide();
    queryWrapper.find('.add-sources-action').show();
    queryWrapper.find('.source-that-got-added').show();
}
var queryCount = 2;
function addAnotherQuery(){
    var newQuery = $($('.query-wrapper')[0]).clone();
    newQuery.removeClass('first-query-wrapper').attr('id','query'+queryCount);
    newQuery.find('.query-number').html(queryCount);
    newQuery.find('.date-range-start').datepicker({format: 'yyyy-mm-dd'});
    newQuery.find('.date-range-end').datepicker({format: 'yyyy-mm-dd'});
    $('#query-list-wrapper').append(newQuery);
    queryCount++;
    newQuery.show();
    updateSingleOrMultiple();
}
function updateSingleOrMultiple(){
    var visibleQueryCount = $('.query-wrapper:visible').length;
    if(visibleQueryCount>1){
        $('#runOneBtn').hide();
        $('#runManyBtn').show();
    } else {
        $('#runOneBtn').show();
        $('#runManyBtn').hide();
    }
    if(visibleQueryCount>3){
        $('#scrollRightNote').fadeIn();
    } else {
        $('#scrollRightNote').fadeOut();
    }
}
function hideQuery(elem){
    var queryWrapper = $(elem).closest('.query-wrapper');
    queryWrapper.hide();
    updateSingleOrMultiple();
}
        </script>
    </body>
</html>
